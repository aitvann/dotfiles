#! /usr/bin/env bb
; vim: set ft=clojure:

(require
 '[babashka.cli :as cli]
 '[babashka.process :refer [sh]])

(def home (System/getProperty "user.home"))

(def opts (cli/parse-args *command-line-args*))
(def proxy? (contains? (:opts opts) :proxy))

; -o "%(album_artist&{} - |)s%(album|singletones)s/%(creator&{} - |)#s%(track,title)#s.%(ext)s" \
; --extractor-args "youtubetab:skip=authcheck" \

(apply
 sh {:out :inherit :err :inherit} "yt-dlp"
 (concat
  (if proxy? ["--proxy" "socks5://127.0.0.1:10808"] [])
  ["-P" (str home "data/knowledge-base/media/music/import-source/")]
  ["-o" "%(creator).200B%(creator.201&...|)s%(creator& - |)#s%(track,title)#s.%(ext)s"]
  ["--download-archive" (str home "data/knowledge-base/media/music/dlp-index.txt")]
  ["-f" "bestaudio"]
  ["--extract-audio"]
  ["--embed-thumbnail"]
  ["--embed-metadata"]
  ["--cookies-from-browser" "firefox"]
  ["https://music.youtube.com/playlist?list=LM"]))

