pid /run/nginx/nginx.pid;
error_log stderr;
daemon off;
events {
}

http {
    default_type application/octet-stream;
	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305;
	# Keep in sync with https://ssl-config.mozilla.org/#server=nginx&config=intermediate
	ssl_ecdh_curve X25519:prime256v1:secp384r1;
	ssl_session_timeout 1d;
	ssl_session_cache shared:SSL:10m;
	# Breaks forward secrecy: https://github.com/mozilla/server-side-tls/issues/135
	ssl_session_tickets off;
	# We don't enable insecure ciphers by default, so this allows
	# clients to pick the most performant, per https://github.com/mozilla/server-side-tls/issues/260
	ssl_prefer_server_ciphers off;

	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name sun.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name sun.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://192.168.1.1;
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name webui.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name webui.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://192.168.1.16:2402;

            # WebSocket support
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name torrent.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl;
		listen [::0]:443 ssl;
		server_name torrent.homelab.io;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:8112;
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name jellyfin.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name jellyfin.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:8096;

            # WebSocket support
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name radarr.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name radarr.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:7878;
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name sonarr.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name sonarr.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:8989;
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name lidarr.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name lidarr.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:8686;
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name kitchenowl.homelab.io;
		location / {
			proxy_pass http://localhost:3043;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name kitchenowl.homelab.io;
		http2 on;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:3043;
		}
	}
	server {
		listen 0.0.0.0:80;
		listen [::0]:80;
		server_name adguard.homelab.io;
		location / {
			return 301 https://$host$request_uri;
		}
	}
	server {
		listen 0.0.0.0:443 ssl ;
		listen [::0]:443 ssl ;
		server_name adguard.homelab.io;
		ssl_certificate /etc/cert/cert.pem;
		ssl_certificate_key /etc/cert/key.pem;
		location / {
			proxy_pass http://localhost:3000;
		}
	}
}
